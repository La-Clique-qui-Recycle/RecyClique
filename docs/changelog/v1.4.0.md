# Changelog v1.4.0 - Framework Caisse avec Options de Workflow

**Date:** 2025-01-27  
**Story:** B49-P4  
**√âpop√©e:** [EPIC-B49 ‚Äì Framework Caisse avec Options de Workflow](../epics/epic-b49-framework-caisse-options-workflow.md)

## üéâ Nouvelles Fonctionnalit√©s

### Framework d'Options de Workflow

- **Infrastructure d'options configurables par caisse** (B49-P1)
  - Ajout du champ `workflow_options` (JSONB) sur les postes de caisse
  - Support des options extensibles via structure JSON
  - Configuration par poste de caisse via l'interface d'administration

- **Mode Prix Global** (B49-P2)
  - Saisie manuelle du total de vente au lieu du calcul automatique
  - Masquage de l'√©tape "Quantit√©" dans le workflow de caisse
  - Validation du prix 0‚Ç¨ autoris√©e pour les articles sans prix
  - Affichage conditionnel du sous-total dans l'√©cran de finalisation
  - Champ "Total √† payer" avec saisie manuelle obligatoire

- **Refonte Caisses Virtuelles/Diff√©r√©es** (B49-P3)
  - H√©ritage automatique des options de workflow depuis le poste de caisse
  - Support des options dans les sessions virtuelles et diff√©r√©es
  - Workflow identique aux caisses r√©elles avec options h√©rit√©es

## üîß Am√©liorations

### Backend

- **Sch√©mas Pydantic** pour validation stricte des options de workflow
- **Propagation automatique** des options dans les r√©ponses API (`register_options`)
- **R√©trocompatibilit√©** garantie avec les caisses existantes (valeurs par d√©faut)

### Frontend

- **Stores Zustand** mis √† jour pour g√©rer les options de workflow
- **Composants React** adaptatifs selon les options activ√©es
- **Interface d'administration** pour la configuration des options

## üìö Documentation

### Guides Utilisateur

- [Guide de Configuration des Options de Workflow](../guides/workflow-options-configuration.md)
- [Guide d'Utilisation du Mode Prix Global](../guides/mode-prix-global-utilisation.md)

### Guides D√©veloppeur

- [Guide Architecture des Options de Workflow](../guides/workflow-options-architecture.md)
- [Guide Ajouter une Nouvelle Option](../guides/ajouter-option-workflow.md)

## üß™ Tests

### Tests Unitaires

- Tests `cashSessionStore.submitSale` avec `overrideTotalAmount`
- Tests `SaleWizard` workflow standard vs mode prix global
- Tests `FinalizationScreen` avec champ total manuel
- Couverture > 80% pour tous les composants modifi√©s

### Tests d'Int√©gration

- Tests API options (cr√©ation/update caisse avec options)
- Tests h√©ritage options virtuel/diff√©r√©
- Tests propagation options dans stores
- Tests filtrage dashboard

### Tests E2E

- Sc√©narios complets mode prix global (ajout items, finalisation)
- Sc√©narios caisse virtuelle avec options h√©rit√©es
- Sc√©narios caisse diff√©r√©e avec options h√©rit√©es
- Sc√©narios workflow standard inchang√©

### Tests de R√©gression

- V√©rification workflow standard inchang√©
- V√©rification validation prix 0‚Ç¨ bloqu√©e en workflow standard
- V√©rification toutes fonctionnalit√©s existantes intactes
- Tests performance (pas de d√©gradation)

## üîÑ Changements Techniques

### Base de Donn√©es

- **Migration Alembic:** Ajout colonnes `workflow_options`, `enable_virtual`, `enable_deferred` sur `cash_registers`
- **Type JSONB** pour stockage flexible des options
- **Valeurs par d√©faut** pour r√©trocompatibilit√©

### API

- **Nouveaux champs** dans `CashRegisterResponse`: `workflow_options`, `enable_virtual`, `enable_deferred`
- **Nouveau champ** dans `CashSessionResponse`: `register_options`
- **Validation Pydantic** pour les options de workflow

### Frontend

- **Types TypeScript** pour `WorkflowOptions` et `WorkflowFeatureOption`
- **Store Zustand** avec `currentRegisterOptions`
- **Composants adaptatifs** selon les options activ√©es

## üêõ Corrections

- Aucune correction majeure (fonctionnalit√©s nouvelles)

## ‚ö†Ô∏è Breaking Changes

**Aucun breaking change.** Toutes les modifications sont r√©trocompatibles :
- Les caisses existantes fonctionnent sans modification
- Le workflow standard reste inchang√© si les options ne sont pas activ√©es
- Les valeurs par d√©faut garantissent la compatibilit√©

## üìù Notes de Migration

### Pour les Administrateurs

1. **Aucune action requise** pour les caisses existantes
2. **Configuration optionnelle** des options de workflow via l'interface d'administration
3. **Activation progressive** recommand√©e pour tester le mode prix global

### Pour les D√©veloppeurs

1. **Mise √† jour des d√©pendances** (si n√©cessaire)
2. **Ex√©cution des migrations** Alembic pour ajouter les nouvelles colonnes
3. **Revue de la documentation** pour comprendre l'architecture des options

## üîó R√©f√©rences

- **Epic B49:** [Framework Caisse avec Options de Workflow](../epics/epic-b49-framework-caisse-options-workflow.md)
- **Story B49-P1:** [Infrastructure Options de Workflow](../stories/story-b49-p1-infrastructure-options-workflow.md)
- **Story B49-P2:** [Mode Prix Global](../stories/story-b49-p2-mode-prix-global.md)
- **Story B49-P3:** [Refonte Caisses Virtuelles/Diff√©r√©es](../stories/story-b49-p3-refonte-caisses-virtuelles-differees.md)
- **Story B49-P4:** [Tests et Documentation](../stories/story-b49-p4-tests-et-documentation.md)

## üë• Contributeurs

- D√©veloppement: James (Dev Agent)
- Tests: James (Dev Agent)
- Documentation: James (Dev Agent)

---

**Version pr√©c√©dente:** [v1.3.1](../changelog/v1.3.1.md) (si disponible)

